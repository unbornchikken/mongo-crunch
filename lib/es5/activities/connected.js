"use strict";
"use strict";
var wf4node = require("../../../deps/workflow-4-node");
var util = require('util');
var Activity = wf4node.activities.Activity;
var Db = require('mongodb').Db;
var debug = require("debug")("mongo-crunch:Connected");
function Connected() {
  Activity.call(this);
  this.connection = '';
  this.nonScopedProperties.add('getDb');
}
util.inherits(Connected, Activity);
Connected.prototype.getDb = function(scope) {
  var connections = scope.get('connections');
  var connection = scope.get('connection') || 'default';
  debug(("Getting Db for connection: " + connection + "."));
  var result = connections[connection];
  if (!(result instanceof Db)) {
    throw new Error('MongoDB connection \'' + connection + '\' doesn\'t exists.');
  }
  debug(("Db '" + result.databaseName + "' found."));
  return result;
};
module.exports = Connected;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNvbm5lY3RlZC5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTtBQUFBLFdBQVcsQ0FBQztBQUVaLEFBQUksRUFBQSxDQUFBLE9BQU0sRUFBSSxDQUFBLE9BQU0sQUFBQyxDQUFDLCtCQUE4QixDQUFDLENBQUM7QUFDdEQsQUFBSSxFQUFBLENBQUEsSUFBRyxFQUFJLENBQUEsT0FBTSxBQUFDLENBQUMsTUFBSyxDQUFDLENBQUM7QUFDMUIsQUFBSSxFQUFBLENBQUEsUUFBTyxFQUFJLENBQUEsT0FBTSxXQUFXLFNBQVMsQ0FBQztBQUMxQyxBQUFJLEVBQUEsQ0FBQSxFQUFDLEVBQUksQ0FBQSxPQUFNLEFBQUMsQ0FBQyxTQUFRLENBQUMsR0FBRyxDQUFDO0FBQzlCLEFBQUksRUFBQSxDQUFBLEtBQUksRUFBSSxDQUFBLE9BQU0sQUFBQyxDQUFDLE9BQU0sQ0FBQyxBQUFDLENBQUMsd0JBQXVCLENBQUMsQ0FBQztBQUV0RCxPQUFTLFVBQVEsQ0FBRSxBQUFELENBQUc7QUFDakIsU0FBTyxLQUFLLEFBQUMsQ0FBQyxJQUFHLENBQUMsQ0FBQztBQUVuQixLQUFHLFdBQVcsRUFBSSxHQUFDLENBQUM7QUFDcEIsS0FBRyxvQkFBb0IsSUFBSSxBQUFDLENBQUMsT0FBTSxDQUFDLENBQUM7QUFDekM7QUFBQSxBQUVBLEdBQUcsU0FBUyxBQUFDLENBQUMsU0FBUSxDQUFHLFNBQU8sQ0FBQyxDQUFDO0FBRWxDLFFBQVEsVUFBVSxNQUFNLEVBQUksVUFBVSxLQUFJLENBQUc7QUFDekMsQUFBSSxJQUFBLENBQUEsV0FBVSxFQUFJLENBQUEsS0FBSSxJQUFJLEFBQUMsQ0FBQyxhQUFZLENBQUMsQ0FBQztBQUMxQyxBQUFJLElBQUEsQ0FBQSxVQUFTLEVBQUksQ0FBQSxLQUFJLElBQUksQUFBQyxDQUFDLFlBQVcsQ0FBQyxDQUFBLEVBQUssVUFBUSxDQUFDO0FBRXJELE1BQUksQUFBQyxFQUFDLDZCQUE2QixFQUFDLFdBQVMsRUFBQyxJQUFFLEVBQUMsQ0FBQztBQUVsRCxBQUFJLElBQUEsQ0FBQSxNQUFLLEVBQUksQ0FBQSxXQUFVLENBQUUsVUFBUyxDQUFDLENBQUM7QUFDcEMsS0FBSSxDQUFDLENBQUMsTUFBSyxXQUFhLEdBQUMsQ0FBQyxDQUFHO0FBQ3pCLFFBQU0sSUFBSSxNQUFJLEFBQUMsQ0FBQyx1QkFBc0IsRUFBSSxXQUFTLENBQUEsQ0FBSSxzQkFBb0IsQ0FBQyxDQUFDO0VBQ2pGO0FBQUEsQUFFQSxNQUFJLEFBQUMsRUFBQyxNQUFNLEVBQUMsQ0FBQSxNQUFLLGFBQWEsRUFBQyxXQUFTLEVBQUMsQ0FBQztBQUMzQyxPQUFPLE9BQUssQ0FBQztBQUNqQixDQUFDO0FBRUQsS0FBSyxRQUFRLEVBQUksVUFBUSxDQUFDO0FBQzFCIiwiZmlsZSI6ImFjdGl2aXRpZXMvY29ubmVjdGVkLmpzIiwic291cmNlUm9vdCI6ImxpYi9lczYiLCJzb3VyY2VzQ29udGVudCI6WyJcInVzZSBzdHJpY3RcIjtcclxuXHJcbmxldCB3ZjRub2RlID0gcmVxdWlyZShcIi4uLy4uLy4uL2RlcHMvd29ya2Zsb3ctNC1ub2RlXCIpO1xyXG5sZXQgdXRpbCA9IHJlcXVpcmUoJ3V0aWwnKTtcclxubGV0IEFjdGl2aXR5ID0gd2Y0bm9kZS5hY3Rpdml0aWVzLkFjdGl2aXR5O1xyXG5sZXQgRGIgPSByZXF1aXJlKCdtb25nb2RiJykuRGI7XHJcbmxldCBkZWJ1ZyA9IHJlcXVpcmUoXCJkZWJ1Z1wiKShcIm1vbmdvLWNydW5jaDpDb25uZWN0ZWRcIik7XHJcblxyXG5mdW5jdGlvbiBDb25uZWN0ZWQoKSB7XHJcbiAgICBBY3Rpdml0eS5jYWxsKHRoaXMpO1xyXG5cclxuICAgIHRoaXMuY29ubmVjdGlvbiA9ICcnO1xyXG4gICAgdGhpcy5ub25TY29wZWRQcm9wZXJ0aWVzLmFkZCgnZ2V0RGInKTtcclxufVxyXG5cclxudXRpbC5pbmhlcml0cyhDb25uZWN0ZWQsIEFjdGl2aXR5KTtcclxuXHJcbkNvbm5lY3RlZC5wcm90b3R5cGUuZ2V0RGIgPSBmdW5jdGlvbiAoc2NvcGUpIHtcclxuICAgIGxldCBjb25uZWN0aW9ucyA9IHNjb3BlLmdldCgnY29ubmVjdGlvbnMnKTtcclxuICAgIGxldCBjb25uZWN0aW9uID0gc2NvcGUuZ2V0KCdjb25uZWN0aW9uJykgfHwgJ2RlZmF1bHQnO1xyXG5cclxuICAgIGRlYnVnKGBHZXR0aW5nIERiIGZvciBjb25uZWN0aW9uOiAke2Nvbm5lY3Rpb259LmApO1xyXG5cclxuICAgIGxldCByZXN1bHQgPSBjb25uZWN0aW9uc1tjb25uZWN0aW9uXTtcclxuICAgIGlmICghKHJlc3VsdCBpbnN0YW5jZW9mIERiKSkge1xyXG4gICAgICAgIHRocm93IG5ldyBFcnJvcignTW9uZ29EQiBjb25uZWN0aW9uIFxcJycgKyBjb25uZWN0aW9uICsgJ1xcJyBkb2VzblxcJ3QgZXhpc3RzLicpO1xyXG4gICAgfVxyXG5cclxuICAgIGRlYnVnKGBEYiAnJHtyZXN1bHQuZGF0YWJhc2VOYW1lfScgZm91bmQuYCk7XHJcbiAgICByZXR1cm4gcmVzdWx0O1xyXG59O1xyXG5cclxubW9kdWxlLmV4cG9ydHMgPSBDb25uZWN0ZWQ7XHJcbiJdfQ==
