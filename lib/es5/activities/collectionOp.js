"use strict";
"use strict";
var wf4node = require("../../../deps/workflow-4-node");
var util = require('util');
var Activity = wf4node.activities.Activity;
var Collection = require('mongodb').Collection;
function CollectionOp() {
  Activity.call(this);
  this.collection = null;
  this.nonScopedProperties.add('getCollection');
  this.nonScopedProperties.add('doWork');
}
util.inherits(CollectionOp, Activity);
CollectionOp.prototype.getCollection = function(scope) {
  var collection = scope.get('collection');
  if (!(collection instanceof Collection))
    throw new Error('MongoDB collection \'' + collection + '\' doesn\'t exists.');
  return collection;
};
CollectionOp.prototype.run = function(callContext, args) {
  callContext.schedule(this.get('collection'), '_collectionGot');
};
CollectionOp.prototype._collectionGot = function(callContext, reason, result) {
  if (reason !== Activity.states.complete) {
    callContext.end(reason, result);
    return ;
  }
  callContext.activity.doWork.call(this, callContext);
};
CollectionOp.prototype.doWork = function(callContext) {
  callContext.fail(new Error("Not implemented."));
};
module.exports = CollectionOp;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNvbGxlY3Rpb25PcC5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTtBQUFBLFdBQVcsQ0FBQztBQUVaLEFBQUksRUFBQSxDQUFBLE9BQU0sRUFBSSxDQUFBLE9BQU0sQUFBQyxDQUFDLCtCQUE4QixDQUFDLENBQUM7QUFDdEQsQUFBSSxFQUFBLENBQUEsSUFBRyxFQUFJLENBQUEsT0FBTSxBQUFDLENBQUMsTUFBSyxDQUFDLENBQUM7QUFDMUIsQUFBSSxFQUFBLENBQUEsUUFBTyxFQUFJLENBQUEsT0FBTSxXQUFXLFNBQVMsQ0FBQztBQUMxQyxBQUFJLEVBQUEsQ0FBQSxVQUFTLEVBQUksQ0FBQSxPQUFNLEFBQUMsQ0FBQyxTQUFRLENBQUMsV0FBVyxDQUFDO0FBRTlDLE9BQVMsYUFBVyxDQUFFLEFBQUQsQ0FBRztBQUNwQixTQUFPLEtBQUssQUFBQyxDQUFDLElBQUcsQ0FBQyxDQUFDO0FBRW5CLEtBQUcsV0FBVyxFQUFJLEtBQUcsQ0FBQztBQUN0QixLQUFHLG9CQUFvQixJQUFJLEFBQUMsQ0FBQyxlQUFjLENBQUMsQ0FBQztBQUM3QyxLQUFHLG9CQUFvQixJQUFJLEFBQUMsQ0FBQyxRQUFPLENBQUMsQ0FBQztBQUMxQztBQUFBLEFBRUEsR0FBRyxTQUFTLEFBQUMsQ0FBQyxZQUFXLENBQUcsU0FBTyxDQUFDLENBQUM7QUFFckMsV0FBVyxVQUFVLGNBQWMsRUFBSSxVQUFTLEtBQUksQ0FBRztBQUNuRCxBQUFJLElBQUEsQ0FBQSxVQUFTLEVBQUksQ0FBQSxLQUFJLElBQUksQUFBQyxDQUFDLFlBQVcsQ0FBQyxDQUFDO0FBQ3hDLEtBQUksQ0FBQyxDQUFDLFVBQVMsV0FBYSxXQUFTLENBQUM7QUFBRyxRQUFNLElBQUksTUFBSSxBQUFDLENBQUMsdUJBQXNCLEVBQUksV0FBUyxDQUFBLENBQUksc0JBQW9CLENBQUMsQ0FBQztBQUFBLEFBQ3RILE9BQU8sV0FBUyxDQUFDO0FBQ3JCLENBQUM7QUFFRCxXQUFXLFVBQVUsSUFBSSxFQUFJLFVBQVMsV0FBVSxDQUFHLENBQUEsSUFBRyxDQUFHO0FBQ3JELFlBQVUsU0FBUyxBQUFDLENBQUMsSUFBRyxJQUFJLEFBQUMsQ0FBQyxZQUFXLENBQUMsQ0FBRyxpQkFBZSxDQUFDLENBQUM7QUFDbEUsQ0FBQTtBQUVBLFdBQVcsVUFBVSxlQUFlLEVBQUksVUFBUyxXQUFVLENBQUcsQ0FBQSxNQUFLLENBQUcsQ0FBQSxNQUFLLENBQUc7QUFDMUUsS0FBSSxNQUFLLElBQU0sQ0FBQSxRQUFPLE9BQU8sU0FBUyxDQUFHO0FBQ3JDLGNBQVUsSUFBSSxBQUFDLENBQUMsTUFBSyxDQUFHLE9BQUssQ0FBQyxDQUFDO0FBQy9CLFdBQU07RUFDVjtBQUFBLEFBRUEsWUFBVSxTQUFTLE9BQU8sS0FBSyxBQUFDLENBQUMsSUFBRyxDQUFHLFlBQVUsQ0FBQyxDQUFDO0FBQ3ZELENBQUE7QUFFQSxXQUFXLFVBQVUsT0FBTyxFQUFJLFVBQVMsV0FBVSxDQUFFO0FBQ2pELFlBQVUsS0FBSyxBQUFDLENBQUMsR0FBSSxNQUFJLEFBQUMsQ0FBQyxrQkFBaUIsQ0FBQyxDQUFDLENBQUM7QUFDbkQsQ0FBQTtBQUVBLEtBQUssUUFBUSxFQUFJLGFBQVcsQ0FBQztBQUFBIiwiZmlsZSI6ImFjdGl2aXRpZXMvY29sbGVjdGlvbk9wLmpzIiwic291cmNlUm9vdCI6ImxpYi9lczYiLCJzb3VyY2VzQ29udGVudCI6WyJcInVzZSBzdHJpY3RcIjtcclxuXHJcbmxldCB3ZjRub2RlID0gcmVxdWlyZShcIi4uLy4uLy4uL2RlcHMvd29ya2Zsb3ctNC1ub2RlXCIpO1xyXG5sZXQgdXRpbCA9IHJlcXVpcmUoJ3V0aWwnKTtcclxubGV0IEFjdGl2aXR5ID0gd2Y0bm9kZS5hY3Rpdml0aWVzLkFjdGl2aXR5O1xyXG5sZXQgQ29sbGVjdGlvbiA9IHJlcXVpcmUoJ21vbmdvZGInKS5Db2xsZWN0aW9uO1xyXG5cclxuZnVuY3Rpb24gQ29sbGVjdGlvbk9wKCkge1xyXG4gICAgQWN0aXZpdHkuY2FsbCh0aGlzKTtcclxuXHJcbiAgICB0aGlzLmNvbGxlY3Rpb24gPSBudWxsO1xyXG4gICAgdGhpcy5ub25TY29wZWRQcm9wZXJ0aWVzLmFkZCgnZ2V0Q29sbGVjdGlvbicpO1xyXG4gICAgdGhpcy5ub25TY29wZWRQcm9wZXJ0aWVzLmFkZCgnZG9Xb3JrJyk7XHJcbn1cclxuXHJcbnV0aWwuaW5oZXJpdHMoQ29sbGVjdGlvbk9wLCBBY3Rpdml0eSk7XHJcblxyXG5Db2xsZWN0aW9uT3AucHJvdG90eXBlLmdldENvbGxlY3Rpb24gPSBmdW5jdGlvbihzY29wZSkge1xyXG4gICAgbGV0IGNvbGxlY3Rpb24gPSBzY29wZS5nZXQoJ2NvbGxlY3Rpb24nKTtcclxuICAgIGlmICghKGNvbGxlY3Rpb24gaW5zdGFuY2VvZiBDb2xsZWN0aW9uKSkgdGhyb3cgbmV3IEVycm9yKCdNb25nb0RCIGNvbGxlY3Rpb24gXFwnJyArIGNvbGxlY3Rpb24gKyAnXFwnIGRvZXNuXFwndCBleGlzdHMuJyk7XHJcbiAgICByZXR1cm4gY29sbGVjdGlvbjtcclxufTtcclxuXHJcbkNvbGxlY3Rpb25PcC5wcm90b3R5cGUucnVuID0gZnVuY3Rpb24oY2FsbENvbnRleHQsIGFyZ3MpIHtcclxuICAgIGNhbGxDb250ZXh0LnNjaGVkdWxlKHRoaXMuZ2V0KCdjb2xsZWN0aW9uJyksICdfY29sbGVjdGlvbkdvdCcpO1xyXG59XHJcblxyXG5Db2xsZWN0aW9uT3AucHJvdG90eXBlLl9jb2xsZWN0aW9uR290ID0gZnVuY3Rpb24oY2FsbENvbnRleHQsIHJlYXNvbiwgcmVzdWx0KSB7XHJcbiAgICBpZiAocmVhc29uICE9PSBBY3Rpdml0eS5zdGF0ZXMuY29tcGxldGUpIHtcclxuICAgICAgICBjYWxsQ29udGV4dC5lbmQocmVhc29uLCByZXN1bHQpO1xyXG4gICAgICAgIHJldHVybjtcclxuICAgIH1cclxuXHJcbiAgICBjYWxsQ29udGV4dC5hY3Rpdml0eS5kb1dvcmsuY2FsbCh0aGlzLCBjYWxsQ29udGV4dCk7XHJcbn1cclxuXHJcbkNvbGxlY3Rpb25PcC5wcm90b3R5cGUuZG9Xb3JrID0gZnVuY3Rpb24oY2FsbENvbnRleHQpe1xyXG4gICAgY2FsbENvbnRleHQuZmFpbChuZXcgRXJyb3IoXCJOb3QgaW1wbGVtZW50ZWQuXCIpKTtcclxufVxyXG5cclxubW9kdWxlLmV4cG9ydHMgPSBDb2xsZWN0aW9uT3A7Il19
