"use strict";
"use strict";
var util = require('util');
var Activity = require("../../deps/workflow-4-node").activities.Activity;
var Db = require('mongodb').Db;
var debug = require("debug")("mongo-crunch:Connected");
function Connected() {
  Activity.call(this);
  this.connection = '';
  this.nonScopedProperties.add('getDb');
}
util.inherits(Connected, Activity);
Connected.prototype.getDb = function(scope) {
  var connections = scope.get('connections');
  var connection = scope.get('connection') || 'default';
  debug(("Getting Db for connection: " + connection + "."));
  var result = connections[connection];
  if (!(result instanceof Db)) {
    throw new Error('MongoDB connection \'' + connection + '\' doesn\'t exists.');
  }
  debug(("Db '" + result.databaseName + "' found."));
  return result;
};
module.exports = Connected;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNvbm5lY3RlZC5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTtBQUFBLFdBQVcsQ0FBQztBQUVaLEFBQUksRUFBQSxDQUFBLElBQUcsRUFBSSxDQUFBLE9BQU0sQUFBQyxDQUFDLE1BQUssQ0FBQyxDQUFDO0FBQzFCLEFBQUksRUFBQSxDQUFBLFFBQU8sRUFBSSxDQUFBLE9BQU0sQUFBQyxDQUFDLDRCQUEyQixDQUFDLFdBQVcsU0FBUyxDQUFDO0FBQ3hFLEFBQUksRUFBQSxDQUFBLEVBQUMsRUFBSSxDQUFBLE9BQU0sQUFBQyxDQUFDLFNBQVEsQ0FBQyxHQUFHLENBQUM7QUFDOUIsQUFBSSxFQUFBLENBQUEsS0FBSSxFQUFJLENBQUEsT0FBTSxBQUFDLENBQUMsT0FBTSxDQUFDLEFBQUMsQ0FBQyx3QkFBdUIsQ0FBQyxDQUFDO0FBRXRELE9BQVMsVUFBUSxDQUFFLEFBQUQsQ0FBRztBQUNqQixTQUFPLEtBQUssQUFBQyxDQUFDLElBQUcsQ0FBQyxDQUFDO0FBRW5CLEtBQUcsV0FBVyxFQUFJLEdBQUMsQ0FBQztBQUNwQixLQUFHLG9CQUFvQixJQUFJLEFBQUMsQ0FBQyxPQUFNLENBQUMsQ0FBQztBQUN6QztBQUFBLEFBRUEsR0FBRyxTQUFTLEFBQUMsQ0FBQyxTQUFRLENBQUcsU0FBTyxDQUFDLENBQUM7QUFFbEMsUUFBUSxVQUFVLE1BQU0sRUFBSSxVQUFVLEtBQUksQ0FBRztBQUN6QyxBQUFJLElBQUEsQ0FBQSxXQUFVLEVBQUksQ0FBQSxLQUFJLElBQUksQUFBQyxDQUFDLGFBQVksQ0FBQyxDQUFDO0FBQzFDLEFBQUksSUFBQSxDQUFBLFVBQVMsRUFBSSxDQUFBLEtBQUksSUFBSSxBQUFDLENBQUMsWUFBVyxDQUFDLENBQUEsRUFBSyxVQUFRLENBQUM7QUFFckQsTUFBSSxBQUFDLEVBQUMsNkJBQTZCLEVBQUMsV0FBUyxFQUFDLElBQUUsRUFBQyxDQUFDO0FBRWxELEFBQUksSUFBQSxDQUFBLE1BQUssRUFBSSxDQUFBLFdBQVUsQ0FBRSxVQUFTLENBQUMsQ0FBQztBQUNwQyxLQUFJLENBQUMsQ0FBQyxNQUFLLFdBQWEsR0FBQyxDQUFDLENBQUc7QUFDekIsUUFBTSxJQUFJLE1BQUksQUFBQyxDQUFDLHVCQUFzQixFQUFJLFdBQVMsQ0FBQSxDQUFJLHNCQUFvQixDQUFDLENBQUM7RUFDakY7QUFBQSxBQUVBLE1BQUksQUFBQyxFQUFDLE1BQU0sRUFBQyxDQUFBLE1BQUssYUFBYSxFQUFDLFdBQVMsRUFBQyxDQUFDO0FBQzNDLE9BQU8sT0FBSyxDQUFDO0FBQ2pCLENBQUM7QUFFRCxLQUFLLFFBQVEsRUFBSSxVQUFRLENBQUM7QUFDMUIiLCJmaWxlIjoiYWN0aXZpdGllcy9jb25uZWN0ZWQuanMiLCJzb3VyY2VSb290IjoiQzovR0lUL21vbmdvLWNydW5jaC9saWIvIiwic291cmNlc0NvbnRlbnQiOlsiXCJ1c2Ugc3RyaWN0XCI7XHJcblxyXG5sZXQgdXRpbCA9IHJlcXVpcmUoJ3V0aWwnKTtcclxubGV0IEFjdGl2aXR5ID0gcmVxdWlyZShcIi4uLy4uL2RlcHMvd29ya2Zsb3ctNC1ub2RlXCIpLmFjdGl2aXRpZXMuQWN0aXZpdHk7XHJcbmxldCBEYiA9IHJlcXVpcmUoJ21vbmdvZGInKS5EYjtcclxubGV0IGRlYnVnID0gcmVxdWlyZShcImRlYnVnXCIpKFwibW9uZ28tY3J1bmNoOkNvbm5lY3RlZFwiKTtcclxuXHJcbmZ1bmN0aW9uIENvbm5lY3RlZCgpIHtcclxuICAgIEFjdGl2aXR5LmNhbGwodGhpcyk7XHJcblxyXG4gICAgdGhpcy5jb25uZWN0aW9uID0gJyc7XHJcbiAgICB0aGlzLm5vblNjb3BlZFByb3BlcnRpZXMuYWRkKCdnZXREYicpO1xyXG59XHJcblxyXG51dGlsLmluaGVyaXRzKENvbm5lY3RlZCwgQWN0aXZpdHkpO1xyXG5cclxuQ29ubmVjdGVkLnByb3RvdHlwZS5nZXREYiA9IGZ1bmN0aW9uIChzY29wZSkge1xyXG4gICAgbGV0IGNvbm5lY3Rpb25zID0gc2NvcGUuZ2V0KCdjb25uZWN0aW9ucycpO1xyXG4gICAgbGV0IGNvbm5lY3Rpb24gPSBzY29wZS5nZXQoJ2Nvbm5lY3Rpb24nKSB8fCAnZGVmYXVsdCc7XHJcblxyXG4gICAgZGVidWcoYEdldHRpbmcgRGIgZm9yIGNvbm5lY3Rpb246ICR7Y29ubmVjdGlvbn0uYCk7XHJcblxyXG4gICAgbGV0IHJlc3VsdCA9IGNvbm5lY3Rpb25zW2Nvbm5lY3Rpb25dO1xyXG4gICAgaWYgKCEocmVzdWx0IGluc3RhbmNlb2YgRGIpKSB7XHJcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdNb25nb0RCIGNvbm5lY3Rpb24gXFwnJyArIGNvbm5lY3Rpb24gKyAnXFwnIGRvZXNuXFwndCBleGlzdHMuJyk7XHJcbiAgICB9XHJcblxyXG4gICAgZGVidWcoYERiICcke3Jlc3VsdC5kYXRhYmFzZU5hbWV9JyBmb3VuZC5gKTtcclxuICAgIHJldHVybiByZXN1bHQ7XHJcbn07XHJcblxyXG5tb2R1bGUuZXhwb3J0cyA9IENvbm5lY3RlZDtcclxuIl19
