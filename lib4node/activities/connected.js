"use strict";
var util = require('util');
var Activity = require("../../deps/workflow-4-node").activities.Activity;
var Db = require('mongodb').Db;
var debug = require("debug")("mongo-crunch:Connected");
function Connected() {
  Activity.call(this);
  this.connection = '';
  this.nonScopedProperties.add('getDb');
}
util.inherits(Connected, Activity);
Connected.prototype.getDb = function(scope) {
  var connections = scope.get('connections');
  var connection = scope.get('connection') || 'default';
  debug(("Getting Db for connection: " + connection + "."));
  var result = connections[connection];
  if (!(result instanceof Db)) {
    throw new Error('MongoDB connection \'' + connection + '\' doesn\'t exists.');
  }
  debug(("Db '" + result.databaseName + "' found."));
  return result;
};
module.exports = Connected;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNvbm5lY3RlZC5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTtBQUFBLEFBQUksRUFBQSxDQUFBLElBQUcsRUFBSSxDQUFBLE9BQU0sQUFBQyxDQUFDLE1BQUssQ0FBQyxDQUFDO0FBQzFCLEFBQUksRUFBQSxDQUFBLFFBQU8sRUFBSSxDQUFBLE9BQU0sQUFBQyxDQUFDLDRCQUEyQixDQUFDLFdBQVcsU0FBUyxDQUFDO0FBQ3hFLEFBQUksRUFBQSxDQUFBLEVBQUMsRUFBSSxDQUFBLE9BQU0sQUFBQyxDQUFDLFNBQVEsQ0FBQyxHQUFHLENBQUM7QUFDOUIsQUFBSSxFQUFBLENBQUEsS0FBSSxFQUFJLENBQUEsT0FBTSxBQUFDLENBQUMsT0FBTSxDQUFDLEFBQUMsQ0FBQyx3QkFBdUIsQ0FBQyxDQUFDO0FBRXRELE9BQVMsVUFBUSxDQUFFLEFBQUQsQ0FBRztBQUNqQixTQUFPLEtBQUssQUFBQyxDQUFDLElBQUcsQ0FBQyxDQUFDO0FBRW5CLEtBQUcsV0FBVyxFQUFJLEdBQUMsQ0FBQztBQUNwQixLQUFHLG9CQUFvQixJQUFJLEFBQUMsQ0FBQyxPQUFNLENBQUMsQ0FBQztBQUN6QztBQUFBLEFBRUEsR0FBRyxTQUFTLEFBQUMsQ0FBQyxTQUFRLENBQUcsU0FBTyxDQUFDLENBQUM7QUFFbEMsUUFBUSxVQUFVLE1BQU0sRUFBSSxVQUFVLEtBQUksQ0FBRztBQUN6QyxBQUFJLElBQUEsQ0FBQSxXQUFVLEVBQUksQ0FBQSxLQUFJLElBQUksQUFBQyxDQUFDLGFBQVksQ0FBQyxDQUFDO0FBQzFDLEFBQUksSUFBQSxDQUFBLFVBQVMsRUFBSSxDQUFBLEtBQUksSUFBSSxBQUFDLENBQUMsWUFBVyxDQUFDLENBQUEsRUFBSyxVQUFRLENBQUM7QUFFckQsTUFBSSxBQUFDLEVBQUMsNkJBQTZCLEVBQUMsV0FBUyxFQUFDLElBQUUsRUFBQyxDQUFDO0FBRWxELEFBQUksSUFBQSxDQUFBLE1BQUssRUFBSSxDQUFBLFdBQVUsQ0FBRSxVQUFTLENBQUMsQ0FBQztBQUNwQyxLQUFJLENBQUMsQ0FBQyxNQUFLLFdBQWEsR0FBQyxDQUFDLENBQUc7QUFDekIsUUFBTSxJQUFJLE1BQUksQUFBQyxDQUFDLHVCQUFzQixFQUFJLFdBQVMsQ0FBQSxDQUFJLHNCQUFvQixDQUFDLENBQUM7RUFDakY7QUFBQSxBQUVBLE1BQUksQUFBQyxFQUFDLE1BQU0sRUFBQyxDQUFBLE1BQUssYUFBYSxFQUFDLFdBQVMsRUFBQyxDQUFDO0FBQzNDLE9BQU8sT0FBSyxDQUFDO0FBQ2pCLENBQUM7QUFFRCxLQUFLLFFBQVEsRUFBSSxVQUFRLENBQUM7QUFDMUIiLCJmaWxlIjoiYWN0aXZpdGllcy9jb25uZWN0ZWQuanMiLCJzb3VyY2VSb290IjoiQzovR0lUL21vbmdvLWNydW5jaC9saWIvIiwic291cmNlc0NvbnRlbnQiOlsidmFyIHV0aWwgPSByZXF1aXJlKCd1dGlsJyk7XHJcbnZhciBBY3Rpdml0eSA9IHJlcXVpcmUoXCIuLi8uLi9kZXBzL3dvcmtmbG93LTQtbm9kZVwiKS5hY3Rpdml0aWVzLkFjdGl2aXR5O1xyXG52YXIgRGIgPSByZXF1aXJlKCdtb25nb2RiJykuRGI7XHJcbnZhciBkZWJ1ZyA9IHJlcXVpcmUoXCJkZWJ1Z1wiKShcIm1vbmdvLWNydW5jaDpDb25uZWN0ZWRcIik7XHJcblxyXG5mdW5jdGlvbiBDb25uZWN0ZWQoKSB7XHJcbiAgICBBY3Rpdml0eS5jYWxsKHRoaXMpO1xyXG5cclxuICAgIHRoaXMuY29ubmVjdGlvbiA9ICcnO1xyXG4gICAgdGhpcy5ub25TY29wZWRQcm9wZXJ0aWVzLmFkZCgnZ2V0RGInKTtcclxufVxyXG5cclxudXRpbC5pbmhlcml0cyhDb25uZWN0ZWQsIEFjdGl2aXR5KTtcclxuXHJcbkNvbm5lY3RlZC5wcm90b3R5cGUuZ2V0RGIgPSBmdW5jdGlvbiAoc2NvcGUpIHtcclxuICAgIHZhciBjb25uZWN0aW9ucyA9IHNjb3BlLmdldCgnY29ubmVjdGlvbnMnKTtcclxuICAgIHZhciBjb25uZWN0aW9uID0gc2NvcGUuZ2V0KCdjb25uZWN0aW9uJykgfHwgJ2RlZmF1bHQnO1xyXG5cclxuICAgIGRlYnVnKGBHZXR0aW5nIERiIGZvciBjb25uZWN0aW9uOiAke2Nvbm5lY3Rpb259LmApO1xyXG5cclxuICAgIHZhciByZXN1bHQgPSBjb25uZWN0aW9uc1tjb25uZWN0aW9uXTtcclxuICAgIGlmICghKHJlc3VsdCBpbnN0YW5jZW9mIERiKSkge1xyXG4gICAgICAgIHRocm93IG5ldyBFcnJvcignTW9uZ29EQiBjb25uZWN0aW9uIFxcJycgKyBjb25uZWN0aW9uICsgJ1xcJyBkb2VzblxcJ3QgZXhpc3RzLicpO1xyXG4gICAgfVxyXG5cclxuICAgIGRlYnVnKGBEYiAnJHtyZXN1bHQuZGF0YWJhc2VOYW1lfScgZm91bmQuYCk7XHJcbiAgICByZXR1cm4gcmVzdWx0O1xyXG59O1xyXG5cclxubW9kdWxlLmV4cG9ydHMgPSBDb25uZWN0ZWQ7XHJcbiJdfQ==
