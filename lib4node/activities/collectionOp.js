"use strict";
"use strict";
var util = require('util');
var Activity = require("../../deps/workflow-4-node").activities.Activity;
var Collection = require('mongodb').Collection;
function CollectionOp() {
  Activity.call(this);
  this.collection = null;
  this.nonScopedProperties.add('getCollection');
  this.nonScopedProperties.add('doWork');
}
util.inherits(CollectionOp, Activity);
CollectionOp.prototype.getCollection = function(scope) {
  var collection = scope.get('collection');
  if (!(collection instanceof Collection))
    throw new Error('MongoDB collection \'' + collection + '\' doesn\'t exists.');
  return collection;
};
CollectionOp.prototype.run = function(callContext, args) {
  callContext.schedule(this.get('collection'), '_collectionGot');
};
CollectionOp.prototype._collectionGot = function(callContext, reason, result) {
  if (reason !== Activity.states.complete) {
    callContext.end(reason, result);
    return ;
  }
  callContext.activity.doWork.call(this, callContext);
};
CollectionOp.prototype.doWork = function(callContext) {
  callContext.fail(new Error("Not implemented."));
};
module.exports = CollectionOp;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNvbGxlY3Rpb25PcC5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTtBQUFBLFdBQVcsQ0FBQztBQUVaLEFBQUksRUFBQSxDQUFBLElBQUcsRUFBSSxDQUFBLE9BQU0sQUFBQyxDQUFDLE1BQUssQ0FBQyxDQUFDO0FBQzFCLEFBQUksRUFBQSxDQUFBLFFBQU8sRUFBSSxDQUFBLE9BQU0sQUFBQyxDQUFDLDRCQUEyQixDQUFDLFdBQVcsU0FBUyxDQUFDO0FBQ3hFLEFBQUksRUFBQSxDQUFBLFVBQVMsRUFBSSxDQUFBLE9BQU0sQUFBQyxDQUFDLFNBQVEsQ0FBQyxXQUFXLENBQUM7QUFFOUMsT0FBUyxhQUFXLENBQUUsQUFBRCxDQUFHO0FBQ3BCLFNBQU8sS0FBSyxBQUFDLENBQUMsSUFBRyxDQUFDLENBQUM7QUFFbkIsS0FBRyxXQUFXLEVBQUksS0FBRyxDQUFDO0FBQ3RCLEtBQUcsb0JBQW9CLElBQUksQUFBQyxDQUFDLGVBQWMsQ0FBQyxDQUFDO0FBQzdDLEtBQUcsb0JBQW9CLElBQUksQUFBQyxDQUFDLFFBQU8sQ0FBQyxDQUFDO0FBQzFDO0FBQUEsQUFFQSxHQUFHLFNBQVMsQUFBQyxDQUFDLFlBQVcsQ0FBRyxTQUFPLENBQUMsQ0FBQztBQUVyQyxXQUFXLFVBQVUsY0FBYyxFQUFJLFVBQVMsS0FBSSxDQUFHO0FBQ25ELEFBQUksSUFBQSxDQUFBLFVBQVMsRUFBSSxDQUFBLEtBQUksSUFBSSxBQUFDLENBQUMsWUFBVyxDQUFDLENBQUM7QUFDeEMsS0FBSSxDQUFDLENBQUMsVUFBUyxXQUFhLFdBQVMsQ0FBQztBQUFHLFFBQU0sSUFBSSxNQUFJLEFBQUMsQ0FBQyx1QkFBc0IsRUFBSSxXQUFTLENBQUEsQ0FBSSxzQkFBb0IsQ0FBQyxDQUFDO0FBQUEsQUFDdEgsT0FBTyxXQUFTLENBQUM7QUFDckIsQ0FBQztBQUVELFdBQVcsVUFBVSxJQUFJLEVBQUksVUFBUyxXQUFVLENBQUcsQ0FBQSxJQUFHLENBQUc7QUFDckQsWUFBVSxTQUFTLEFBQUMsQ0FBQyxJQUFHLElBQUksQUFBQyxDQUFDLFlBQVcsQ0FBQyxDQUFHLGlCQUFlLENBQUMsQ0FBQztBQUNsRSxDQUFBO0FBRUEsV0FBVyxVQUFVLGVBQWUsRUFBSSxVQUFTLFdBQVUsQ0FBRyxDQUFBLE1BQUssQ0FBRyxDQUFBLE1BQUssQ0FBRztBQUMxRSxLQUFJLE1BQUssSUFBTSxDQUFBLFFBQU8sT0FBTyxTQUFTLENBQUc7QUFDckMsY0FBVSxJQUFJLEFBQUMsQ0FBQyxNQUFLLENBQUcsT0FBSyxDQUFDLENBQUM7QUFDL0IsV0FBTTtFQUNWO0FBQUEsQUFFQSxZQUFVLFNBQVMsT0FBTyxLQUFLLEFBQUMsQ0FBQyxJQUFHLENBQUcsWUFBVSxDQUFDLENBQUM7QUFDdkQsQ0FBQTtBQUVBLFdBQVcsVUFBVSxPQUFPLEVBQUksVUFBUyxXQUFVLENBQUU7QUFDakQsWUFBVSxLQUFLLEFBQUMsQ0FBQyxHQUFJLE1BQUksQUFBQyxDQUFDLGtCQUFpQixDQUFDLENBQUMsQ0FBQztBQUNuRCxDQUFBO0FBRUEsS0FBSyxRQUFRLEVBQUksYUFBVyxDQUFDO0FBQUEiLCJmaWxlIjoiYWN0aXZpdGllcy9jb2xsZWN0aW9uT3AuanMiLCJzb3VyY2VSb290IjoiQzovR0lUL21vbmdvLWNydW5jaC9saWIvIiwic291cmNlc0NvbnRlbnQiOlsiXCJ1c2Ugc3RyaWN0XCI7XHJcblxyXG5sZXQgdXRpbCA9IHJlcXVpcmUoJ3V0aWwnKTtcclxubGV0IEFjdGl2aXR5ID0gcmVxdWlyZShcIi4uLy4uL2RlcHMvd29ya2Zsb3ctNC1ub2RlXCIpLmFjdGl2aXRpZXMuQWN0aXZpdHk7XHJcbmxldCBDb2xsZWN0aW9uID0gcmVxdWlyZSgnbW9uZ29kYicpLkNvbGxlY3Rpb247XHJcblxyXG5mdW5jdGlvbiBDb2xsZWN0aW9uT3AoKSB7XHJcbiAgICBBY3Rpdml0eS5jYWxsKHRoaXMpO1xyXG5cclxuICAgIHRoaXMuY29sbGVjdGlvbiA9IG51bGw7XHJcbiAgICB0aGlzLm5vblNjb3BlZFByb3BlcnRpZXMuYWRkKCdnZXRDb2xsZWN0aW9uJyk7XHJcbiAgICB0aGlzLm5vblNjb3BlZFByb3BlcnRpZXMuYWRkKCdkb1dvcmsnKTtcclxufVxyXG5cclxudXRpbC5pbmhlcml0cyhDb2xsZWN0aW9uT3AsIEFjdGl2aXR5KTtcclxuXHJcbkNvbGxlY3Rpb25PcC5wcm90b3R5cGUuZ2V0Q29sbGVjdGlvbiA9IGZ1bmN0aW9uKHNjb3BlKSB7XHJcbiAgICBsZXQgY29sbGVjdGlvbiA9IHNjb3BlLmdldCgnY29sbGVjdGlvbicpO1xyXG4gICAgaWYgKCEoY29sbGVjdGlvbiBpbnN0YW5jZW9mIENvbGxlY3Rpb24pKSB0aHJvdyBuZXcgRXJyb3IoJ01vbmdvREIgY29sbGVjdGlvbiBcXCcnICsgY29sbGVjdGlvbiArICdcXCcgZG9lc25cXCd0IGV4aXN0cy4nKTtcclxuICAgIHJldHVybiBjb2xsZWN0aW9uO1xyXG59O1xyXG5cclxuQ29sbGVjdGlvbk9wLnByb3RvdHlwZS5ydW4gPSBmdW5jdGlvbihjYWxsQ29udGV4dCwgYXJncykge1xyXG4gICAgY2FsbENvbnRleHQuc2NoZWR1bGUodGhpcy5nZXQoJ2NvbGxlY3Rpb24nKSwgJ19jb2xsZWN0aW9uR290Jyk7XHJcbn1cclxuXHJcbkNvbGxlY3Rpb25PcC5wcm90b3R5cGUuX2NvbGxlY3Rpb25Hb3QgPSBmdW5jdGlvbihjYWxsQ29udGV4dCwgcmVhc29uLCByZXN1bHQpIHtcclxuICAgIGlmIChyZWFzb24gIT09IEFjdGl2aXR5LnN0YXRlcy5jb21wbGV0ZSkge1xyXG4gICAgICAgIGNhbGxDb250ZXh0LmVuZChyZWFzb24sIHJlc3VsdCk7XHJcbiAgICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG5cclxuICAgIGNhbGxDb250ZXh0LmFjdGl2aXR5LmRvV29yay5jYWxsKHRoaXMsIGNhbGxDb250ZXh0KTtcclxufVxyXG5cclxuQ29sbGVjdGlvbk9wLnByb3RvdHlwZS5kb1dvcmsgPSBmdW5jdGlvbihjYWxsQ29udGV4dCl7XHJcbiAgICBjYWxsQ29udGV4dC5mYWlsKG5ldyBFcnJvcihcIk5vdCBpbXBsZW1lbnRlZC5cIikpO1xyXG59XHJcblxyXG5tb2R1bGUuZXhwb3J0cyA9IENvbGxlY3Rpb25PcDsiXX0=
